<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Book Gallery ğŸ“š</title>
        <style>
            body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            margin: 0;
            padding: 40px;
            color: #333;
            box-sizing: border-box; /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ */
            }

            h1 { text-align: center; color: white; margin-bottom: 30px; }
            .container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                justify-content: center;
            }

            .book-card {
                background: white;
                width: 220px;
                border-radius: 15px;
                padding: 15px;
                box-shadow: 0 8px 20px rgba(0,0,0,0.2);
                text-align: center;
                box-sizing: border-box; /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ */
            }
            .book-card img {
                width: 100%;
                height: auto;
                aspect-ratio: 1 / 1;
                object-fit: contain; /* Ù‚Ø¨Ù„Ø§Ù‹ cover Ø¨ÙˆØ¯ØŒ Ø­Ø§Ù„Ø§ contain */
                border-radius: 10px;
                margin-bottom: 10px;
                padding: 5px; /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù„Ø¨Ù‡â€ŒÙ‡Ø§ */
                background-color: #f0f0f0; /* Ø§Ø®ØªÛŒØ§Ø±ÛŒØŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ± ØªØµÙˆÛŒØ± Ø¨Ø§ Ø­Ø§Ø´ÛŒÙ‡ */
            }

            .book-title { font-weight: bold; color: #2a5298; margin-bottom: 5px; }
            .book-info { font-size: 14px; color: #555; margin-bottom: 3px; }
            #searchDiv { text-align: center; margin-bottom: 30px; }
            #searchInput { padding: 10px; width: 300px; border-radius: 8px; border: 1px solid #ccc; }
            #searchBtn { padding: 10px 20px; border-radius: 8px; border: none; background-color: #2a5298; color: white; cursor: pointer; }
            #searchBtn:hover { background-color: #1e3c72; }
        </style>
    </head>
    <body>

        <h1>Book Gallery ğŸ“š</h1>

        <div id="searchDiv">
            <input type="text" id="searchInput" placeholder="Search by title, author, or publisher">
            <button id="searchBtn">Search</button>
        </div>

        <div class="container" id="booksContainer"></div>
        <script>

            const booksContainer = document.getElementById("booksContainer");
            const searchBtn = document.getElementById("searchBtn");
            const searchInput = document.getElementById("searchInput");

            // ÙˆÙ‚ØªÛŒ Enter Ø²Ø¯Ù‡ Ø´Ø¯ØŒ Ø³Ø±Ú† Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
            searchInput.addEventListener("keydown", (event) => {
                if (event.key === "Enter") {
                    searchBtn.click();  // Ù‡Ù…Ø§Ù† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡
                }
            });

            // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ø¨Ø§ Ú¯Ø±ÛŒØ¯ Û´ Ø³ØªÙˆÙ†Ù‡
            function displayBooks(books) {
                booksContainer.innerHTML = "";
                if (books.length === 0) {
                    booksContainer.innerHTML = "<p style='color:white;'>No books found</p>";
                    return;
                }

                const grid = document.createElement("div");
                grid.style.display = "grid";
                grid.style.gridTemplateColumns = "repeat(4, 1fr)";
                grid.style.gap = "20px";

                books.forEach(book => {
                    const div = document.createElement("div");
                    div.className = "book-card";
                    div.style.background = "white";
                    div.style.borderRadius = "10px";
                    div.style.padding = "10px";
                    div.style.textAlign = "center";
                    div.style.boxShadow = "0 5px 15px rgba(0,0,0,0.2)";

                    div.innerHTML = `
                        <img src="${book.image_path || 'images/book.png'}" alt="${book.title}">
                        <div class="book-title" style="font-weight:bold; margin-top:10px; color:#2a5298;">${book.title}</div>
                        <div class="book-info" style="font-size:14px; color:#555;">Author: ${book.author}</div>
                        <div class="book-info" style="font-size:14px; color:#555;">Publisher: ${book.publisher}</div>
                    `;
                    grid.appendChild(div);
                });

                booksContainer.appendChild(grid);
            }

            // Ø¯Ø±ÛŒØ§ÙØª Ù‡Ù…Ù‡ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
            async function loadAllBooks() {
                try {
                    const res = await fetch("http://127.0.0.1:8000/books/all");
                    const data = await res.json();
                    displayBooks(data);
                } catch(err) {
                    booksContainer.innerHTML = "<p style='color:white;'>Error connecting to server</p>";
                }
            }

            // Ø³Ø±Ú† Ú©ØªØ§Ø¨
            searchBtn.addEventListener("click", async () => {
                const query = searchInput.value.trim();

                if(query.length === 0) {
                    // Ø§Ú¯Ø± Ø³Ø±Ú† Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ â†’ Ù‡Ù…Ù‡ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
                    loadAllBooks();
                    return;
                }

                if(query.length < 3) {
                    alert("Search query must be at least 3 characters");
                    return;
                }

                try {
                    const res = await fetch(`http://127.0.0.1:8000/books/search?query=${encodeURIComponent(query)}`);
                    const data = await res.json();
                    displayBooks(data);
                } catch(err) {
                    booksContainer.innerHTML = "<p style='color:white;'>Error connecting to server</p>";
                }
            });

            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ù…Ù‡ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§
            loadAllBooks();
        </script>
    </body>
</html>